8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  C:\USERS\ANGADS~1\DOWNLO~1\ASM\ASM\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; =========================================================================
                             5     
                             6     public  serial_rec_action, timer0_action, timer1_action, timer2_action
                             7     extrn   print_char:far, print_2hex:far, iodefine:far
                             8     extrn   Set_timer0:far, Set_timer1:far, Set_timer2:far, disable_timer0:far, disable_s
                                   erial:far, enable_serial:far
                             9     
----                        10     STACK_SEG       SEGMENT
0000 (256                   11                     DB      256 DUP(?)
     ??
     )
0100                        12             TOS     LABEL   WORD
----                        13     STACK_SEG       ENDS
                            14     
                            15     
                            16     ;----------------------------------------------------------------
                            17     ;--------------------DATA SEGMENT--------------------------------
                            18     ;----------------------------------------------------------------
                            19     
----                        20     DATA_SEG        SEGMENT
                            21     
                            22             ;-- String messages
0000 0A                     23             MAIN_MESS   DB  10,13,'Main Loop           '
0001 0D
0002 4D61696E204C6F
     6F702020202020
     202020202020
0016 0A                     24             TIMER0_MESS     DB      10,13,'TIMER0 INTERRUPT    '
0017 0D
0018 54494D45523020
     494E5445525255
     505420202020
002C 0A                     25             TIMER1_MESS     DB      10,13,'TIMER1 INTERRUPT    '
002D 0D
002E 54494D45523120
     494E5445525255
     505420202020
0042 0A                     26             TIMER2_MESS     DB      10,13,'TIMER2 INTERRUPT    '
0043 0D
0044 54494D45523220
     494E5445525255
     505420202020
0058 0A                     27             KEY_PRESSED DB  10,13,'KEY PRESSED         '
0059 0D
005A 4B455920505245
     53534544202020
     202020202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    2


LOC  OBJ                  LINE     SOURCE

                            28     
006E 0A                     29             REC_MESS        DB  10,13,'INPUT RECEIVED      '
006F 0D
0070 494E5055542052
     45434549564544
     202020202020
                            30     
0084 5F5F4F50454E           31             OPEN_MESS       DB      '__OPEN'
008A 5F5F4954454D           32             ITEM_MESS       DB      '__ITEM'
0090 5F5F424152435F         33             BARCODE_MESS    DB  '__BARC_'
0097 5F5F5155414E5F         34             QUANTITY_MESS   DB      '__QUAN_'
                            35     
009E 00                     36             PRICE_I         DB      00H
009F 00                     37             PRICE_BCD       DB      00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H
00A0 00
00A1 00
00A2 00
00A3 00
00A4 00
00A5 00
00A6 00
00A7 00                     38             PRICE_DEC       DB  00H
                            39             
00A8 69313030333634         40             PRODUCT1        DB      'i100364,1'
     2C31
00B1 69313233343537         41             PRODUCT2        DB      'i123457,1'     
     2C31
                            42             
00BA 0000                   43             DI_INC  DW 0000H
                            44     
                            45             ; -- Timers counters
                            46     
00BC 2F                     47             T0_COUNT                DB      2FH
00BD 2F                     48             T0_COUNT_SET    DB      2FH
00BE 2F                     49             T1_COUNT                DB      2FH
00BF 2F                     50             T1_COUNT_SET    DB      2FH
00C0 2F                     51             T2_COUNT                DB      2FH
00C1 2F                     52             T2_COUNT_SET    DB      2FH
                            53     
                            54             ; -- BCD and Keypad
                            55     
00C2 FE                     56             LED_SELECT  DB  0FEH
00C3 3F                     57             NUMBERS         DB      03FH, 006H, 05BH, 04FH, 066H, 06DH, 07DH, 007H, 07FH,
                                    06FH
00C4 06
00C5 5B
00C6 4F
00C7 66
00C8 6D
00C9 7D
00CA 07
00CB 7F
00CC 6F
00CD 00                     58             CURRENT_NUMBER DB 00H
00CE 00                     59             BARCODE         DB  00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    3


LOC  OBJ                  LINE     SOURCE

00CF 00
00D0 00
00D1 00
00D2 00
00D3 00
00D4 00
00D5 00
00D6 00
00D7 00
                            60             ;BARCODE                DB  03FH, 03FH, 03FH, 03FH, 03FH, 03FH, 03FH, 03FH, 0
                                   3FH, 03FH
00D8 00                     61             BARCODE_DEC     DB      00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H
00D9 00
00DA 00
00DB 00
00DC 00
00DD 00
00DE 00
00DF 00
00E0 00
00E1 00
00E2 00                     62             BARCODE_I       DB 00H
  0006                      63             BARCODE_LEN             EQU 6
00E3 (6                     64             BARCODE_BUFFER  DB BARCODE_LEN DUP(?)
     ??
     )
  0000                      65             BARCODE_TAIL    EQU 0
                            66             ;BARCODE_TAIL   EQU 0
                            67     
                            68     
00E9 00                     69             QUANTITY                DB  00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H
00EA 00
00EB 00
00EC 00
00ED 00
00EE 00
00EF 00
00F0 00
00F1 00
00F2 00
00F3 00                     70             QUANTITY_DEC    DB      00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H, 00H
00F4 00
00F5 00
00F6 00
00F7 00
00F8 00
00F9 00
00FA 00
00FB 00
00FC 00
00FD 00                     71             QUANTITY_I              DB      00H
00FE 00                     72             QUANTITY_FLAG   DB      00H
00FF 00                     73             TEMP_FLAG               DB      00H
                            74     
                            75             ;TRANSMIT_ARR   DB      30 DUP(?)
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    4


LOC  OBJ                  LINE     SOURCE

                            76             ;TRANSMIT_C             DB      00H
                            77     
                            78             ;-- TODO: Add BCD Mappings
0100 7F                     79             ENTER_BARCODE DB        07FH, 07FH, 07FH, 07FH, 07FH, 07FH
0101 7F
0102 7F
0103 7F
0104 7F
0105 7F
0106 6F                     80             ENTER_QUANTITY  DB      06FH, 06FH, 06FH, 06FH, 06FH, 06FH 
0107 6F
0108 6F
0109 6F
010A 6F
010B 6F
                            81             
                            82             
010C 00                     83             KEYPAD_CURRENT_ROW DB 00H
010D FE                     84             KEYPAD_ROW      DB 0FEH; 
010E FC                     85             KEYPAD1_HASH            DB      0FCH, 0F3H, 0F5H, 0F6H, 0FBH, 0F9H, 0FAH, 0F9
                                   H, 0FDH, 0FCH, 0FAH
010F F3
0110 F5
0111 F6
0112 FB
0113 F9
0114 FA
0115 F9
0116 FD
0117 FC
0118 FA
0119 EE                     86             KEYPAD2_HASH    DB      0EEH, 0D7H, 0E7H, 0F7H, 0DBH, 0EBH, 0F3H, 0DDH, 0EDH,
                                    0F5H, 0DEH
011A D7
011B E7
011C F7
011D DB
011E EB
011F F3
0120 DD
0121 ED
0122 F5
0123 DE
                            87     
0124 00                     88             TOTAL_DEC               DB      00H
0125 00                     89             TOTAL_WHOLE             DB      00H
0126 00                     90             DECIMAL_ADDED   DB      00H
                            91             ; -- Voice
                            92     
0127 E703                   93             DESIRED_SOUND DW 999
0129 00000000               94             SOUND_ADDR                      DD      0
012D 0000                   95             SOUND_LEFT                      DW      0
012F 00000000               96             SOUND_BASE_ADDR         DD      0, 4713, 8481, 11945, 15315, 18317, 21614, 26
                                   120, 30013, 31809
0133 69120000
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    5


LOC  OBJ                  LINE     SOURCE

0137 21210000
013B A92E0000
013F D33B0000
0143 8D470000
0147 6E540000
014B 08660000
014F 3D750000
0153 417C0000
0157 0B8D0000               97                                                     DD      36107, 39110, 43768, 47646, 5
                                   1847, 56124, 60775, 66907, 73225
015B C6980000
015F F8AA0000
0163 1EBA0000
0167 87CA0000
016B 3CDB0000
016F 67ED0000
0173 5B050100
0177 091E0100
017B B8320100               98                                                     DD      78520, 84565, 87674, 90326, 9
                                   3756, 96907, 101370, 106075, 109155
017F 554A0100
0183 7A560100
0187 D6600100
018B 3C6E0100
018F 8B7A0100
0193 FA8B0100
0197 5B9E0100
019B 63AA0100
019F D6B80100               99                                                     DD      112854, 115703, 118631, 12186
                                   7, 126347, 129602, 133161, 134469
01A3 F7C30100
01A7 67CF0100
01AB 0BDC0100
01AF 8BED0100
01B3 42FA0100
01B7 29080200
01BB 450D0200
01BF 87180200              100                                                     DD      137351, 141625, 146695, 15250
                                   3, 159103, 162214, 166331, 170638
01C3 39290200
01C7 073D0200
01CB B7530200
01CF 7F6D0200
01D3 A6790200
01D7 BB890200
01DB 8E9A0200
01DF 99AE0200              101                                                     DD      175769, 178219, 181435, 18339
                                   1, 187071, 191560, 196299, 198222
01E3 2BB80200
01E7 BBC40200
01EB 5FCC0200
01EF BFDA0200
01F3 48EC0200
01F7 CBFE0200
01FB 4E060300
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    6


LOC  OBJ                  LINE     SOURCE

01FF 81120300              102                                                     DD      201345, 205826, 210477, 21377
                                   0, 216003, 219454, 225267, 229879
0203 02240300
0207 2D360300
020B 0A430300
020F C34B0300
0213 3E590300
0217 F36F0300
021B F7810300
021F 98950300              103                                                     DD      234904, 242475, 249711, 25986
                                   2, 260667
0223 2BB30300
0227 6FCF0300
022B 16F70300
022F 3BFA0300
0233 6912                  104             SOUND_SIZE                      DW      4713, 3768, 3464, 3370, 3002, 3297, 4
                                   506, 3893, 1796, 4298
0235 B80E
0237 880D
0239 2A0D
023B BA0B
023D E10C
023F 9A11
0241 350F
0243 0407
0245 CA10
0247 BB0B                  105                                                     DW      3003, 4658, 3878, 4201, 4277,
                                    4651, 6132, 6318, 5295, 6045
0249 3212
024B 260F
024D 6910
024F B510
0251 2B12
0253 F417
0255 AE18
0257 AF14
0259 9D17
025B 250C                  106                                                     DW      3109, 2652, 3430, 3151, 4463,
                                    4705, 3080, 3699, 2849, 2928
025D 5C0A
025F 660D
0261 4F0C
0263 6F11
0265 6112
0267 080C
0269 730E
026B 210B
026D 700B
026F A40C                  107                                                     DW      3236, 4480, 3255, 3559, 1308,
                                    2882, 4274, 5070, 5808, 6600
0271 8011
0273 B70C
0275 E70D
0277 1C05
0279 420B
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    7


LOC  OBJ                  LINE     SOURCE

027B B210
027D CE13
027F B016
0281 C819
0283 270C                  108                                                     DW      3111, 4117, 4307, 5131, 2450,
                                    3216, 1956, 3680, 4489, 4739
0285 1510
0287 D310
0289 0B14
028B 9209
028D 900C
028F A407
0291 600E
0293 8911
0295 8312
0297 8307                  109                                                     DW      1923, 3123, 4481, 4651, 3293,
                                    2233, 3451, 5813, 4612, 5025
0299 330C
029B 8111
029D 2B12
029F DD0C
02A1 B908
02A3 7B0D
02A5 B516
02A7 0412
02A9 A113
02AB 931D                  110                                                     DW      7571, 7236, 10151, 805, 800
02AD 441C
02AF A727
02B1 2503
02B3 2003
  0000                     111             SOUND_INIT                      EQU 0
  001C                     112             SOUND_HUNDRED           EQU     28
  001D                     113             SOUND_THOUSAND          EQU     29
  001E                     114             SOUND_PRODUCT           EQU     30
  0032                     115             SOUND_AND                       EQU     50
  0034                     116             SOUND_COST                      EQU     52
  0035                     117             SOUND_DOLLAR            EQU     53
  0036                     118             SOUND_CENT                      EQU     54
  0037                     119             SOUND_GREETING          EQU     55
  0038                     120             SOUND_MORNING           EQU     56
  0039                     121             SOUND_AFTERNOON         EQU     57
  003A                     122             SOUND_EVENING           EQU     58
  003B                     123             SOUND_PAY                       EQU     59
  003C                     124             SOUND_PURCHASE          EQU     60
  003D                     125             SOUND_CHANGE            EQU     61
  003E                     126             SOUND_EXIT                      EQU     62
  003F                     127             SOUND_BEEP                      EQU     63
  0040                     128             SOUND_SILENCE           EQU     64
  0020                     129             SOUND_QUEUE_LEN         EQU     32
02B5 (32                   130             SOUND_QUEUE                     DB      SOUND_QUEUE_LEN DUP(?)
     ??
     )
02D5 00                    131             SOUND_HEAD                      DB      0
02D6 00                    132             SOUND_TAIL                      DB      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    8


LOC  OBJ                  LINE     SOURCE

02D7 00                    133             SOUND_TEST_LEFT         DB      0
                           134             
02D8 0000                  135             TOTAL                           DW 0
                           136     
----                       137     DATA_SEG        ENDS
                           138     
                           139     ;----------------------------------------------------------------
                           140     ;--------------------DATA SEGMENT END----------------------------
                           141     ;----------------------------------------------------------------
                           142     
                           143     
                           144     ;----------------------------------------------------------------
                           145     ;--------------------CHIP SELECTS--------------------------------
                           146     ;----------------------------------------------------------------
                           147     ; 8255 register addresses
                           148     ; PCS1
  0080                     149     IC8255_PORTA_ADDR EQU 80H;
  0081                     150     IC8255_PORTB_ADDR EQU 81H;
  0082                     151     IC8255_PORTC_ADDR EQU 82H;
  0083                     152     IC8255_CW_ADDR    EQU 83H;
                           153     
  0100                     154     PCS2_ADDR EQU 100H
  0180                     155     PCS3_ADDR EQU 180H
  0200                     156     PCS4_ADDR EQU 200H
                           157     
  FFA6                     158     MMCS EQU 0FFA6H
  FFA8                     159     MPCS EQU 0FFA8H
                           160     
                           161     ;----------------------------------------------------------------
                           162     ;-------------------CHIP SELECT END------------------------------
                           163     ;----------------------------------------------------------------
                           164     
                           165     
                           166     ;----------------------------------------------------------------
                           167     ;--------------------CODE SEGMENT--------------------------------
                           168     ;----------------------------------------------------------------
                           169     
----                       170     CODE_SEG        SEGMENT
                           171             PUBLIC          START
                           172     ASSUME          CS:CODE_SEG, SS:STACK_SEG, DS:DATA_SEG
                           173     
0000                       174     START:
                           175     
                           176     ;-----------------------STACK AREA INIT--------------------------
0000 B8----         R      177             MOV     AX, STACK_SEG           
0003 8ED0                  178             MOV     SS, AX
0005 368B260001            179             MOV     SP, TOS
                           180     
000A B8----         R      181             MOV AX, DATA_SEG
000D 8ED8                  182             MOV DS, AX
                           183     ;----------------------------------------------------------------
                           184     
                           185     ;--------------ON-CHIP PERIPEHRALS--------------------------------
000F 9A0000----     E      186             CALL    FAR PTR IODEFINE
                           187             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE    9


LOC  OBJ                  LINE     SOURCE

                           188             ;IC8255 - Control Word
0014 BA8300                189             MOV DX, IC8255_CW_ADDR
                           190     
                           191             ;CW Register 
                           192             ;Port C Lower Input, Port C Upper Output 
                           193             ;Port B input, Port A output
                           194             ;1 0 0 0 0 0 1 0
0017 B082                  195             MOV AL, 82H
0019 EE                    196             OUT DX, AL
                           197     
                           198     ; Initialize MCS
                           199     
001A BAA6FF                200             MOV DX, MMCS
001D B80380                201             MOV     AX, 8003H
0020 EF                    202             OUT     DX, AX
                           203     
0021 BAA8FF                204             MOV DX, MPCS
0024 B88440                205             MOV AX, 4084H
0027 EF                    206             OUT DX, AX
                           207     
                           208     ;----------------------------------------------------------------
                           209     
                           210     ;This procedure generates 10ms delay at 5MHz
                           211     ;operating frequency, which corresponds to 
                           212     ;50,000 clock cycles.
                           213     ;DEBOUNCE PROC  NEAR
                           214     ;       PUSH    CX
                           215     ;       MOV CX, 094Ch ; 2380 dec
                           216     ;       BACK:           
                           217     ;               NOP       ; 3 clocks
                           218     ;       LOOP BACK; 18 clocks
                           219     ;       POP CX
                           220     ;       RET
                           221     ;DEBOUNCE ENDP
                           222     
                           223     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           224     
                           225     ;------------------------Setting the timers---------------------
                           226         ;call Set_timer0
                           227             ;call Set_timer1
0028 9A0000----     E      228             call Set_timer2
002D FB                    229           STI
                           230     ;---------------------------------------------------------------
                           231     
002E                       232     NEXT:
                           233     ;----------------------------------------------------------------
                           234     ;--------------------MAIN LOOP INIT------------------------------
                           235     ;----------------------------------------------------------------
                           236     
                           237             ;slowing down the main loop
002E B9FF5F                238             MOV CX, 05FFFH ; 2380 dec
0031                       239             SLEEP:
0031 90                    240                     NOP
0032 E2FD                  241             LOOP SLEEP; 18 clocks
                           242     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   10


LOC  OBJ                  LINE     SOURCE

                           243     ;----------------------------------------------------------------
                           244     ;--------------------START KEYPAD----------------------------------
                           245     ;----------------------------------------------------------------
0034 33C0                  246             XOR AX, AX
0036 D0060D01              247             ROL KEYPAD_ROW, 01H
003A 803E0D0177            248             CMP KEYPAD_ROW, 77H
003F 7402                  249             JE RESET_KEYPAD_ROW
0041 7505                  250             JNZ CHECK_KEYPAD_ROW
                           251     
0043                       252     RESET_KEYPAD_ROW:
0043 C6060D010E            253             MOV KEYPAD_ROW, 0EH
                           254     
0048                       255     CHECK_KEYPAD_ROW:
0048 A00D01                256             MOV AL, KEYPAD_ROW
004B BA8200                257             MOV DX, IC8255_PORTC_ADDR       ;DX = Port B Address
004E EE                    258             OUT DX, AL                                      ;
004F BA8100                259             MOV DX, IC8255_PORTB_ADDR       ;
                           260     
0052                       261     CHECK_KEY_CLOSED:                               ;Check when key is pressed. Keep loop
                                   ing here
0052 EC                    262             IN AL, DX                                       ;Move to AL, value in Port B.
                                    
                           263             
                           264             ;--TODO: Get rid of these compares
0053 3C00                  265             CMP AL, 00H
0055 74D7                  266             JE NEXT
0057 3C3F                  267             CMP AL, 03FH
0059 74D3                  268             JE NEXT
005B 3CFF                  269             CMP AL, 0FFH
005D 74CF                  270             JE NEXT
005F 3CBF                  271             CMP AL, 0BFH
0061 74CB                  272             JE NEXT
0063 3C7F                  273             CMP AL, 07FH
0065 74C7                  274             JE NEXT
0067 3C0F                  275             CMP AL, 0FH
0069 74C3                  276             JE NEXT
006B 3C08                  277             CMP AL, 08H
006D 74BF                  278             JE NEXT
                           279     
                           280             ;ANGAD'S SMARTASS HASHING ALGO
006F 22060D01              281             AND AL, KEYPAD_ROW
0073 8A260D01              282             MOV AH, KEYPAD_ROW
                           283     
0077 E80200                284             CALL NEAR PTR KEYPAD_PROCESS
                           285     
                           286     
                           287     ;----------------------------------------------------------------
                           288     ;--------------------END KEYPAD----------------------------------
                           289     ;----------------------------------------------------------------
007A EBB2                  290     JMP NEXT
                           291     
                           292     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
007C                       293     KEYPAD_PROCESS PROC NEAR
007C 50                    294             PUSH AX
007D 53                    295             PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   11


LOC  OBJ                  LINE     SOURCE

007E 51                    296             PUSH CX
007F 52                    297             PUSH DX
0080 1E                    298             PUSH DS
                           299     
0081 BA----         R      300             MOV     DX, DATA_SEG
0084 8EDA                  301             MOV     DS, DX
                           302     
                           303             ;-------Keypad 1------------
                           304     
0086 B90A00                305             MOV CX, 10
0089                       306             FIND_KEY:
0089 8BD9                  307                     MOV BX, CX
008B 8AA70E01              308                     MOV AH, KEYPAD1_HASH[BX]
008F 3AE0                  309                     CMP AH, AL
0091 7404                  310                     JE RESOLVE_COLLISION
0093 E2F4                  311             LOOP FIND_KEY
                           312     
0095 7574                  313             JNE KEYPAD2
                           314     
0097                       315             RESOLVE_COLLISION:
0097 A00D01                316                     MOV AL, KEYPAD_ROW
                           317     
                           318                     ;PUSH AX
                           319                     ;CALL FAR PTR PRINT_2HEX
                           320                     ;MOV AL, 0AH ;NEW LINE
                           321                     ;CALL   FAR PTR PRINT_CHAR
                           322                     ;MOV AL, 0DH ;CARRIAGE RETURN
                           323                     ;CALL   FAR PTR PRINT_CHAR
                           324                     ;POP AX
                           325     
009A 83F90A                326                     CMP CX, 10
009D 7435                  327                     JE COLLISION_6_STAR
009F 83F907                328                     CMP CX, 7
00A2 7439                  329                     JE COLLISION_7_5
00A4 83F909                330                     CMP CX, 9
00A7 743D                  331                     JE COLLISION_9_0
                           332     
00A9                       333             ADD_BARCODE:
00A9 8BD9                  334                     MOV BX, CX
00AB 8A87C300              335                     MOV AL, NUMBERS[BX]
00AF 8BCB                  336                     MOV CX, BX
00B1 8A1EE200              337                     MOV BL, BARCODE_I
00B5 8887CE00              338                     MOV BARCODE[BX], AL
00B9 888FD800              339                     MOV BARCODE_DEC[BX], CL
00BD FE06E200              340                     INC BARCODE_I
00C1 8A87D800              341                     MOV AL, BARCODE_DEC[BX]
00C5 0430                  342                     ADD AL, 48
00C7 9A0000----     E      343                     CALL FAR PTR PRINT_CHAR
00CC B03F                  344                     MOV AL, SOUND_BEEP
00CE E84D01                345                     CALL VOICE_ON_QUEUE
00D1 E9B200                346                     JMP KEYPAD_EXIT
                           347     
00D4                       348             COLLISION_6_STAR:
00D4 3CFE                  349                     CMP AL, 0FEH
00D6 7417                  350                     JE CLEAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   12


LOC  OBJ                  LINE     SOURCE

00D8 B90600                351                     MOV CX, 6
00DB EBCC                  352                     JMP ADD_BARCODE
                           353     
00DD                       354             COLLISION_7_5:
00DD 3CFB                  355                     CMP AL, 0FBH
00DF 75C8                  356                     JNE ADD_BARCODE
00E1 B90500                357                     MOV CX, 5
00E4 EBC3                  358                     JMP ADD_BARCODE
                           359     
00E6                       360             COLLISION_9_0:
00E6 3CFE                  361                     CMP AL, 0FEH
00E8 75BF                  362                     JNE ADD_BARCODE
00EA B90000                363                     MOV CX, 0
00ED EBBA                  364                     JMP ADD_BARCODE
                           365     
00EF                       366             CLEAR:
00EF 33DB                  367                     XOR BX, BX
00F1 B90800                368                     MOV CX, 08H
00F4                       369                     CLEAR_BARCODE:
00F4 8BD9                  370                             MOV BX, CX
00F6 4B                    371                             DEC BX
00F7 C687CE0000            372                             MOV BARCODE[BX], 00H
00FC C687D80000            373                             MOV BARCODE_DEC[BX], 00H
0101 E2F1                  374                     LOOP CLEAR_BARCODE
0103 C606E20000            375                     MOV BARCODE_I, 00H
0108 EB7C90                376                     JMP KEYPAD_EXIT
                           377     
010B                       378             KEYPAD2:
010B B90A00                379                     MOV CX, 10
010E                       380                     FIND_KEY2:
010E 8BD9                  381                             MOV BX, CX
0110 8AA71901              382                             MOV AH, KEYPAD2_HASH[BX]
0114 3AE0                  383                             CMP AH, AL
0116 7402                  384                             JE PROCESS_COMMAND
0118 E2F4                  385                     LOOP FIND_KEY2
                           386     
011A                       387                     PROCESS_COMMAND:
011A 83F901                388                             CMP CX, 1
011D 7417                  389                             JE NEW_TRANSACTION
011F 83F902                390                             CMP CX, 2
0122 7426                  391                             JE NEW_ITEM
0124 83F903                392                             CMP CX, 3
0127 742B                  393                             JE SEND_BARCODE
0129 83F90A                394                             CMP CX, 10
012C 7437                  395                             JE SEND_QUANTITY
012E 83F905                396                             CMP CX, 5
0131 7444                  397                             JE DONE_TRANSACTION
0133 EB5190                398                             JMP KEYPAD_EXIT
                           399     
                           400                     ; New transaction
                           401                     ; Send [OP]EN to shop pc
                           402                     ; Play greeting
0136                       403                     NEW_TRANSACTION:
0136 B05F                  404                             MOV AL, '_'
0138 9A0000----     E      405                             CALL FAR PTR PRINT_CHAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   13


LOC  OBJ                  LINE     SOURCE

                           406                             ;MOV AL, ':'
                           407                             ;CALL FAR PTR PRINT_CHAR
013D B037                  408                             MOV AL, SOUND_GREETING
013F E8DC00                409                             CALL NEAR PTR VOICE_ON_QUEUE
0142 B039                  410                             MOV AL, SOUND_AFTERNOON
0144 E8D700                411                             CALL NEAR PTR VOICE_ON_QUEUE
0147 EB3D90                412                             JMP KEYPAD_EXIT
                           413     
                           414                     ; New item
                           415                     ; Send [IT]EM to shop pc
                           416                     ; Clear BCD
                           417                     ; Wait for user to input Barcode
014A                       418                     NEW_ITEM:
014A B03F                  419                             MOV AL, SOUND_BEEP
014C E8CF00                420                             CALL NEAR PTR VOICE_ON_QUEUE
014F EB9E                  421                             JMP CLEAR
0151 EB3390                422                             JMP KEYPAD_EXIT
                           423     
0154                       424                     SEND_BARCODE:
0154 B03F                  425                             MOV AL, SOUND_BEEP
0156 E8C500                426                             CALL NEAR PTR VOICE_ON_QUEUE
0159 B02C                  427                             MOV AL, ','
015B 9A0000----     E      428                             CALL FAR PTR PRINT_CHAR
0160 EB8D                  429                             JMP CLEAR
0162 EB2290                430                             JMP KEYPAD_EXIT
                           431     
0165                       432                     SEND_QUANTITY:
0165 B03F                  433                             MOV AL, SOUND_BEEP
0167 E8B400                434                             CALL NEAR PTR VOICE_ON_QUEUE
016A B06E                  435                             MOV AL, 'n'
016C 9A0000----     E      436                             CALL FAR PTR PRINT_CHAR
0171 E97BFF                437                             JMP CLEAR
0174 EB1090                438                             JMP KEYPAD_EXIT
                           439     
0177                       440                     DONE_TRANSACTION:
0177 B03F                  441                             MOV AL, SOUND_BEEP
0179 E8A200                442                             CALL NEAR PTR VOICE_ON_QUEUE
017C B074                  443                             MOV AL, 't'
017E 9A0000----     E      444                             CALL FAR PTR PRINT_CHAR
0183 E969FF                445                             JMP CLEAR
                           446     
                           447     
0186                       448     KEYPAD_EXIT:
0186 1F                    449             POP     DS
0187 5A                    450             POP DX
0188 59                    451             POP CX
0189 5B                    452             POP BX
018A 58                    453             POP AX
                           454     
018B C3                    455             RET
                           456     KEYPAD_PROCESS ENDP
                           457     
018C                       458     SAY_PRICE PROC NEAR
018C 50                    459             PUSH AX
                           460             ;MOV AX, TOTAL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   14


LOC  OBJ                  LINE     SOURCE

018D B038                  461             MOV AL, SOUND_MORNING
018F E88C00                462             CALL NEAR PTR VOICE_ON_QUEUE
                           463     
0192 B89800                464             MOV AX, 152             ;1 hundred fifty 2
0195 E80200                465             CALL NEAR PTR PRICE_ON_QUEUE
                           466             
0198 58                    467             POP AX
0199 C3                    468             RET
                           469     SAY_PRICE ENDP
                           470     
019A                       471     PRICE_ON_QUEUE PROC NEAR
019A 60                    472             PUSHA
                           473             
                           474             ; Divide out dollars and cents, dollars in AX, cents in DX
019B BA0000                475             MOV DX, 0
019E B96400                476             MOV CX, 100
01A1 F7F1                  477             DIV CX
                           478             
                           479             ;Please pay
01A3 B03B                  480             MOV AL, SOUND_PAY
01A5 E87600                481             CALL NEAR PTR VOICE_ON_QUEUE
                           482     
                           483             ; Push dollars
01A8 E81600                484             CALL NEAR PTR NUMBER_ON_QUEUE
                           485             
                           486             ; "Dollars"
01AB B035                  487             MOV AL, SOUND_DOLLAR
01AD E86E00                488             CALL NEAR PTR VOICE_ON_QUEUE
                           489             
                           490             ; "And"
01B0 B032                  491             MOV AL, SOUND_AND
01B2 E86900                492             CALL NEAR PTR VOICE_ON_QUEUE
                           493             
                           494             ; Push cents
01B5 8BC2                  495             MOV AX, DX
01B7 E80700                496             CALL NEAR PTR NUMBER_ON_QUEUE
                           497             
                           498             ; "Cents"
01BA B036                  499             MOV AL, SOUND_CENT
01BC E85F00                500             CALL NEAR PTR VOICE_ON_QUEUE
                           501             
01BF 61                    502             POPA
01C0 C3                    503             RET
                           504     PRICE_ON_QUEUE ENDP
                           505     
                           506     ; Pushes number onto queue, do not care about buffer overflow
                           507     ; Always do speech in main program, since interrupts might change SOUND_HEAD arbitrar
                                   y
                           508     ; Input: AX contains the value
                           509     ; 0 to 999 can be represented
01C1                       510     NUMBER_ON_QUEUE PROC NEAR
01C1 60                    511             PUSHA
                           512             
                           513             ; Check whether it is less than 100
01C2 8BD0                  514             MOV DX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   15


LOC  OBJ                  LINE     SOURCE

01C4 81FAE803              515             CMP DX, 1000
01C8 7812                  516             JS NUMBER_ON_QUEUE_SKIP_THOUSAND
                           517             
                           518             ; Converting hundred place
01CA 8BC2                  519             MOV AX, DX
01CC BA0000                520             MOV DX, 0
01CF B9E803                521             MOV CX, 1000
01D2 F7F1                  522             DIV CX
                           523             
                           524             ; AX consists of the hundred place digit
01D4 E84700                525             CALL NEAR PTR VOICE_ON_QUEUE
                           526             
                           527             ; "Hundred"
01D7 B01D                  528             MOV AL, SOUND_THOUSAND
01D9 E84200                529             CALL NEAR PTR VOICE_ON_QUEUE
                           530             
01DC                       531     NUMBER_ON_QUEUE_SKIP_THOUSAND:
                           532             ; Check whether it is less than 100
01DC 8BD0                  533             MOV DX, AX
01DE 83FA64                534             CMP DX, 100
01E1 7812                  535             JS NUMBER_ON_QUEUE_SKIP_HUNDERD
                           536             
                           537             ; Converting hundred place
01E3 8BC2                  538             MOV AX, DX
01E5 BA0000                539             MOV DX, 0
01E8 B96400                540             MOV CX, 100
01EB F7F1                  541             DIV CX
                           542             
                           543             ; AX consists of the hundred place digit
01ED E82E00                544             CALL NEAR PTR VOICE_ON_QUEUE
                           545             
                           546             ; "Hundred"
01F0 B01C                  547             MOV AL, SOUND_HUNDRED
01F2 E82900                548             CALL NEAR PTR VOICE_ON_QUEUE
                           549     
01F5                       550     NUMBER_ON_QUEUE_SKIP_HUNDERD:
                           551      
                           552             ; Check whether remainder is 20 or less
01F5 83FA15                553             CMP DX, 21
01F8 7908                  554             JNS NUMBER_ON_QUEUE_GREATER_TWENTY
                           555             
                           556             ; Twenty or less
01FA 8AC2                  557             MOV AL, DL
01FC E81F00                558             CALL NEAR PTR VOICE_ON_QUEUE
                           559             
01FF EB1B90                560             JMP NUMBER_ON_QUEUE_EXIT
                           561             
0202                       562     NUMBER_ON_QUEUE_GREATER_TWENTY:
                           563     
                           564             ; Converting tens place
0202 8BC2                  565             MOV AX, DX
0204 BA0000                566             MOV DX, 0
0207 B90A00                567             MOV CX, 10
020A F7F1                  568             DIV CX
                           569             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   16


LOC  OBJ                  LINE     SOURCE

                           570             ; AX consists of the tens place
020C 051200                571             ADD AX, 18
020F E80C00                572             CALL NEAR PTR VOICE_ON_QUEUE
                           573             
                           574             ; DX consists of the ones place
0212 83FA00                575             CMP DX, 0
0215 7405                  576             JE NUMBER_ON_QUEUE_EXIT
                           577             
0217 8AC2                  578             MOV AL, DL
0219 E80200                579             CALL NEAR PTR VOICE_ON_QUEUE
                           580     
021C                       581     NUMBER_ON_QUEUE_EXIT:
                           582     
021C 61                    583             POPA
021D C3                    584             RET
                           585     NUMBER_ON_QUEUE ENDP
                           586     ;------------------------------------------------
                           587     
                           588     
                           589     ;------------------VOICE-------------------------
021E                       590     VOICE_ON_QUEUE PROC NEAR
021E 50                    591             PUSH AX
021F 53                    592             PUSH BX
0220 52                    593             PUSH DX
0221 1E                    594             PUSH DS
                           595             
0222 BA----         R      596             MOV     DX, DATA_SEG
0225 8EDA                  597             MOV     DS, DX
                           598     
0227 B700                  599             MOV BH, 0
0229 8A1ED502              600             MOV BL, BYTE PTR SOUND_HEAD
022D 8887B502              601             MOV BYTE PTR SOUND_QUEUE[BX], AL
0231 FEC3                  602             INC BL
                           603     
0233 80FB20                604             CMP BL, SOUND_QUEUE_LEN
0236 7502                  605             JNE VOICE_ON_QUEUE_STALL
                           606             
0238 B300                  607             MOV BL, 0
                           608             
023A                       609     VOICE_ON_QUEUE_STALL:
                           610                     
023A 881ED502              611             MOV BYTE PTR SOUND_HEAD, BL
023E 9A0000----     E      612             CALL    FAR PTR Set_timer0
                           613             
0243 1F                    614             POP     DS
0244 5A                    615             POP DX
0245 5B                    616             POP BX
0246 58                    617             POP AX
                           618             
0247 C3                    619             RET
                           620     VOICE_ON_QUEUE ENDP
                           621     
                           622     
0248                       623     SERIAL_REC_ACTION       PROC    FAR
0248 51                    624                     PUSH    CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   17


LOC  OBJ                  LINE     SOURCE

0249 53                    625                     PUSH    BX
024A 1E                    626                     PUSH    DS
                           627     
024B BB----         R      628                     MOV     BX,DATA_SEG             ;initialize data segment register
024E 8EDB                  629                     MOV     DS,BX
                           630     
0250 3C2E                  631                     CMP AL, '.'
0252 7447                  632                     JE ADD_DECIMAL
                           633     
0254 3C24                  634                     CMP AL, '$'
0256 746E                  635                     JE VOICE_DECIMAL
                           636                     
0258 3C30                  637                     CMP AL, '0'
025A 7C7D                  638                     JL S_RET
                           639     
025C                       640             REST_SER_REC:
025C FE06BD00              641                     INC     DS:T0_COUNT_SET
0260 FE06BD00              642                     INC     DS:T0_COUNT_SET
                           643      
0264                       644     DISP_PRICE:
                           645     
0264 33DB                  646             XOR BX, BX
0266 8AD8                  647             MOV BL, AL
0268 80EB30                648             SUB BL, 48
026B 8A87C300              649             MOV AL, NUMBERS[BX]
026F 8BCB                  650             MOV CX, BX
0271 8A1EE200              651             MOV BL, BARCODE_I
0275 8887CE00              652             MOV BARCODE[BX], AL
0279 888FD800              653             MOV BARCODE_DEC[BX], CL
027D FE06E200              654             INC BARCODE_I
                           655     
0281 33C0                  656             XOR AX, AX
0283 33C9                  657             XOR CX, CX
0285 A1D802                658             MOV AX, TOTAL
0288 B90A00                659             MOV CX, 10
028B F7E1                  660             MUL CX
028D 8A8FD800              661             MOV CL, BARCODE_DEC[BX]
0291 32ED                  662             XOR CH, CH
0293 03C1                  663             ADD AX, CX
0295 A3D802                664             MOV TOTAL, AX
                           665     ;       MOV BL, AH
                           666     ;       XOR AH, AH
                           667     ;       CALL FAR PTR PRINT_2HEX
                           668     ;       MOV AL, BL
                           669     ;       CALL FAR PTR PRINT_2HEX
                           670     ;       MOV AL, 0AH
                           671     ;       CALL FAR PTR PRINT_CHAR
                           672     
                           673     ;       CMP DECIMAL_ADDED, 1
                           674     ;       JE ADD_DEC
0298 EB3F90                675             JMP S_RET
                           676     
                           677     ;ADD_DEC:
                           678     ;               XOR BX, BX
                           679     ;               MOV BX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   18


LOC  OBJ                  LINE     SOURCE

                           680     ;               SUB BL, 48
                           681     ;               MOV AL, TOTAL_DEC
                           682     ;               MOV DX, 10
                           683     ;               MUL DX
                           684     ;               ADD AX, BX
                           685     ;               CALL NEAR PTR NUMBER_ON_QUEUE   
                           686     ;               ;JMP REST_SER_REC
                           687     ;       JMP S_RET
                           688     
                           689     
029B                       690     ADD_DECIMAL:
029B C606260101            691             MOV DECIMAL_ADDED, 1
02A0 33C0                  692             XOR AX, AX
02A2 A1D802                693             MOV AX, TOTAL
02A5 C706D8020000          694             MOV TOTAL, 00H
02AB E813FF                695             CALL NEAR PTR NUMBER_ON_QUEUE
02AE B035                  696             MOV AL, SOUND_DOLLAR
02B0 E86BFF                697             CALL NEAR PTR VOICE_ON_QUEUE
02B3 8A1EE200              698             MOV BL, BARCODE_I
02B7 FECB                  699             DEC BL
02B9 8A87CE00              700             MOV AL, BARCODE[BX]
02BD 0C80                  701             OR AL, 80H
02BF 8887CE00              702             MOV BARCODE[BX], AL
02C3 EB1490                703             JMP S_RET
                           704     
02C6                       705     VOICE_DECIMAL:
02C6 33C0                  706             XOR AX, AX
02C8 A1D802                707             MOV AX, TOTAL
02CB E8F3FE                708             CALL NEAR PTR NUMBER_ON_QUEUE
02CE B036                  709             MOV AL, SOUND_CENT
02D0 E84BFF                710             CALL NEAR PTR VOICE_ON_QUEUE
02D3 C706D8020000          711             MOV TOTAL, 00H
                           712     
02D9                       713     S_RET:
02D9 1F                    714                     POP     DS
02DA 5B                    715                     POP     BX
02DB 59                    716                     POP     CX
02DC CB                    717                     RET
                           718     SERIAL_REC_ACTION       ENDP
                           719     
                           720     
                           721     ;--------------------------------------------------------------
                           722     
                           723     ;--------------------TIMER 0 ----------------------------------
                           724     
02DD                       725     TIMER0_ACTION   PROC    FAR
02DD 50                    726                     PUSH    AX
02DE 1E                    727                     PUSH    DS
02DF 53                    728                     PUSH    BX
02E0 51                    729                     PUSH    CX
                           730     
02E1 33C0                  731             XOR AX,AX
02E3 33DB                  732             XOR BX,BX
02E5 33C9                  733             XOR CX,CX
02E7 33D2                  734             XOR DX,DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   19


LOC  OBJ                  LINE     SOURCE

                           735     
02E9 B8----         R      736             MOV     AX,DATA_SEG
02EC 8ED8                  737             MOV     DS,AX
                           738             
                           739             ;slowing down the timer 
                           740             ;MOV CX, 04FFFH ; 2380 dec
                           741             ;SLEEP_TIMER:
                           742             ;       NOP
                           743             ;LOOP SLEEP_TIMER; 18 clocks
                           744     
                           745     ;----------------------------------------------------
                           746             ; SOUND_LEFT: Number of bytes left in the queue
02EE 833E2D0100            747             CMP WORD PTR SOUND_LEFT, 0
02F3 7544                  748             JNE timer0_ACTION_PROCEED
                           749             
                           750             ; Reload with next item in the queue
02F5 B700                  751             MOV BH, 0
02F7 8A1ED602              752             MOV BL, BYTE PTR SOUND_TAIL
                           753             
02FB 381ED502              754             CMP BYTE PTR SOUND_HEAD, BL
02FF 7508                  755             JNE timer0_ACTION_RELOAD
                           756             
                           757             ;disable timer 0, freeing up resources
0301 9A0000----     E      758             call disable_timer0
                           759      
0306 EB6690                760             JMP T0_NEXT1
                           761             
0309                       762     timer0_ACTION_RELOAD:
                           763             
0309 8A9FB502              764             MOV BL, BYTE PTR SOUND_QUEUE[BX]
030D BE2F01                765             MOV SI, OFFSET SOUND_BASE_ADDR
                           766                     
0310 C1E302                767             SHL BX, 2
0313 8B00                  768             MOV AX, WORD PTR [BX][SI]
                           769      
0315 A32901                770             MOV WORD PTR SOUND_ADDR[0], AX
                           771             
0318 8B4002                772             MOV AX, WORD PTR 2[BX][SI]      
031B A32B01                773             MOV WORD PTR SOUND_ADDR[2], AX
                           774             
031E D1EB                  775             SHR BX, 1
0320 BE3302                776             MOV SI, OFFSET SOUND_SIZE
0323 8B00                  777             MOV AX, WORD PTR [BX][SI]
0325 A32D01                778             MOV WORD PTR SOUND_LEFT, AX
0328 A0D602                779             MOV AL, BYTE PTR SOUND_TAIL
032B FEC0                  780             INC AL
032D 3C20                  781             CMP AL, SOUND_QUEUE_LEN
032F 7502                  782             JNE timer0_QUEUE_NO_OVERFLOW
                           783             
0331 B000                  784             MOV AL, 0
                           785             
0333                       786     timer0_QUEUE_NO_OVERFLOW:
                           787     
0333 A2D602                788             MOV BYTE PTR SOUND_TAIL, AL
0336 EB3690                789             JMP T0_NEXT1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   20


LOC  OBJ                  LINE     SOURCE

                           790             
0339                       791     timer0_ACTION_PROCEED:
                           792     
0339 FF0E2D01              793             DEC WORD PTR SOUND_LEFT
                           794             
033D 8B362901              795             MOV SI, WORD PTR SOUND_ADDR[0]
0341 8B3E2B01              796             MOV DI, WORD PTR SOUND_ADDR[2]
                           797     
                           798             ; SI - Intra-segment address, DI - Segment address
0345 83C708                799             ADD DI, 8H
0348 C1E70C                800             SHL DI, 12
                           801     
                           802             ; Set extra segment to point to 8000H, the starting segment of the EEPROM
034B 8EDF                  803             MOV DS, DI
                           804              
                           805             ; Get byte from EEPROM address space
034D 8A04                  806             MOV AL, [SI]
                           807             
                           808             ; Put byte to DAC
034F BA0002                809             MOV DX, PCS4_ADDR
0352 EE                    810             OUT DX, AL
                           811             
                           812             ; Increment EEPROM address to move to the next sample
0353 B8----         R      813             MOV AX, DATA_SEG
0356 8ED8                  814             MOV DS, AX
                           815     
0358 FF062901              816             INC WORD PTR SOUND_ADDR[0]
035C 7510                  817             JNZ T0_NEXT1
                           818     
                           819             ; Increment memory segment
035E FF062B01              820             INC WORD PTR SOUND_ADDR[2]
                           821     
                           822     ;---------------------------------------------
                           823     
                           824     
0362 FE0EBC00              825             DEC     DS:T0_COUNT
0366 7506                  826             JNZ     T0_NEXT1
0368 A0BD00                827             MOV     AL,DS:T0_COUNT_SET
036B A2BC00                828             MOV     DS:T0_COUNT,AL
                           829     
036E                       830     T0_NEXT1:
                           831     ;T0_NEXT1:
036E 59                    832             POP     CX
036F 5B                    833             POP     BX
0370 1F                    834             POP     DS
0371 58                    835             POP AX
0372 CB                    836             RET
                           837     TIMER0_ACTION   ENDP
                           838     
                           839     ;--------------------------------------------------------------
                           840     
                           841     ;--------------------TIMER 1 ----------------------------------
                           842     
0373                       843     TIMER1_ACTION   PROC    FAR
0373 50                    844                     PUSH    AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   21


LOC  OBJ                  LINE     SOURCE

0374 1E                    845                     PUSH    DS
0375 53                    846                     PUSH    BX
0376 51                    847                     PUSH    CX
                           848     
0377 B8----         R      849                     MOV     AX,DATA_SEG
037A 8ED8                  850                     MOV     DS,AX
                           851             
037C FE0EBE00              852                     DEC     DS:T1_COUNT
0380 7517                  853                     JNZ     T1_NEXT1
0382 A0BF00                854                     MOV     AL,DS:T1_COUNT_SET
0385 A2BE00                855                     MOV     DS:T1_COUNT,AL
                           856     
0388 B91400                857                     MOV     CX,20
038B BB0000                858                     MOV     BX,0H
038E                       859     T1_NEXT0:
038E 8A472C                860                     MOV     AL,DS:TIMER1_MESS[BX]
0391 43                    861                     INC     BX
0392 9A0000----     E      862                     CALL    FAR PTR PRINT_CHAR
0397 E2F5                  863                     LOOP    T1_NEXT0
                           864     
0399                       865     T1_NEXT1:       
0399 59                    866                     POP     CX
039A 5B                    867                     POP     BX
039B 1F                    868                     POP     DS
039C 58                    869                     POP     AX
039D CB                    870                     RET
                           871     TIMER1_ACTION   ENDP
                           872     
                           873     ;--------------------------------------------------------------
                           874     
                           875     ;--------------------TIMER 2 ----------------------------------
                           876     
                           877     
039E                       878     TIMER2_ACTION   PROC    FAR
039E 50                    879                     PUSH    AX
039F 1E                    880                     PUSH    DS
03A0 53                    881                     PUSH    BX
03A1 51                    882                     PUSH    CX
                           883     
03A2 33C0                  884                     XOR AX, AX
03A4 33DB                  885                     XOR BX, BX
                           886                     
                           887                     
                           888     ;----------------------------
                           889                     ;AD0 - AD5 PCS3 CS for 7-segment
                           890                     ;7  6  5  4  3  2  1  0
                           891                     ;x  x  A5 A4 A3 A2 A1 A0
03A6 BA8001                892                     MOV DX, PCS3_ADDR
03A9 A0C200                893                     MOV AL, LED_SELECT
                           894                     ;MOV AL, 00111110B
03AC EE                    895                     OUT DX, AL
03AD D006C200              896                     ROL LED_SELECT, 01H
                           897     
                           898                     ;AD0 - AD7 PCS2
                           899                     ;AD7 - DOT (MSB)
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:58:39  12/05/;2  PAGE   22


LOC  OBJ                  LINE     SOURCE

                           900                     
03B1 BA0001                901                     MOV DX, PCS2_ADDR
03B4 8A1ECD00              902                     MOV BL, CURRENT_NUMBER
03B8 8A87CE00              903                     MOV AL, BARCODE[BX]
                           904                     ;MOV AL, 01111111B
03BC EE                    905                     OUT DX, AL
03BD FE06CD00              906                     INC CURRENT_NUMBER
03C1 803ECD0008            907                     CMP CURRENT_NUMBER, 08H
03C6 7411                  908                     JE RESET_CURRENT
03C8 7523                  909                     JNE T2_NEXT1
                           910     ;---------------------------
03CA FE0EC000              911                     DEC     DS:T2_COUNT
03CE 751D                  912                     JNZ     T2_NEXT1
03D0 A0C100                913                     MOV     AL,DS:T2_COUNT_SET
03D3 A2C000                914                     MOV     DS:T2_COUNT,AL
03D6 BB0000                915                     MOV     BX,0H
                           916                     
03D9                       917     RESET_CURRENT:
03D9 C606CD0000            918                     MOV CURRENT_NUMBER, 00H
03DE FE0EC000              919                     DEC     DS:T2_COUNT
03E2 7509                  920                     JNZ     T2_NEXT1
03E4 A0C100                921                     MOV     AL,DS:T2_COUNT_SET
03E7 A2C000                922                     MOV     DS:T2_COUNT,AL
03EA BB0000                923                     MOV     BX,0H
                           924     
03ED                       925     T2_NEXT1:
03ED 59                    926                     POP     CX
03EE 5B                    927                     POP     BX
03EF 1F                    928                     POP     DS
03F0 58                    929                     POP AX
03F1 CB                    930                     RET
                           931     
                           932     TIMER2_ACTION   ENDP
                           933     
                           934     ;--------------------------------------------------------------
                           935     
----                       936     CODE_SEG        ENDS
                           937     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
